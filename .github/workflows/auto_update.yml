name: 每天自动更新 B站热搜

# 触发条件：什么时候运行？
on:
  # 1. 定时运行：每天国际标准时间 0点 (北京时间早上8点)
  schedule:
    - cron: '0 0 * * *'
  # 2. 手动开关：允许你在网页上点按钮手动运行 (方便测试)
  workflow_dispatch:

permissions:
  contents: write  # 赋予机器人“写”文件的权限，这样它才能更新 data.json

jobs:
  build:
    runs-on: ubuntu-latest  # 使用 GitHub 提供的免费 Linux 服务器

    steps:
    # 第一步：把仓库代码下载下来
    - name: Check out code
      uses: actions/checkout@v3

    # 第二步：安装 Python 3.9
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 第三步：安装依赖库 (requests)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    # 第四步：运行你的爬虫脚本
    - name: Run scraper
      run: python scraper.py

    # 第五步：把更新后的 data.json 存回仓库 (关键步骤！)
    - name: Commit and push changes
      run: |
        git config --global user.name "GitHub Action Bot"
        git config --global user.email "action@github.com"
        # 看看有没有文件变化，有变化才提交
        git add data.json
        git commit -m "Auto-update data.json by Bot" || exit 0
        git push